# ===============================
# ğŸ—ï¸ Stage 1: Build á»©ng dá»¥ng báº±ng Maven
# ===============================
FROM maven:3.9.8-eclipse-temurin-21 AS build

WORKDIR /app

COPY . .

RUN mvn clean package -DskipTests


# ===============================
# ğŸš€ Stage 2: Runtime (bypass Cloudflare + Java 17)
# ===============================
FROM jonlabelle/network-tools

# CÃ i Java 17 (vÃ¬ Alpine chá»‰ há»— trá»£ OpenJDK 17, khÃ´ng cÃ³ Java 21)
RUN apk update && \
    apk add --no-cache openjdk17-jre

WORKDIR /app

# Copy file JAR Ä‘Ã£ build tá»« stage trÆ°á»›c
COPY --from=build /app/target/*-SNAPSHOT.jar app.jar

EXPOSE 8081

ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom","-Dspring.profiles.active=local", "-jar", "app.jar"]
