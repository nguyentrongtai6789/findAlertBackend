version: "3.9"

# =====================================================
# ðŸ”§ Environment dÃ¹ng chung
# =====================================================
x-java-environment: &java-environment
  JAVA_OPTS: "-Xms512m -Xmx1024m"
  SPRING_PROFILES_ACTIVE: "local"

# =====================================================
# ðŸš€ Service chÃ­nh: Java App (LOCAL BUILD)
# =====================================================
services:
  java-app:
    build:
      context: .
      dockerfile: DockerfileLocal
    working_dir: /app

    environment:
      <<: *java-environment
      APP_ENV: local

    command: ["java", "-XX:+UseContainerSupport", "-Djava.security.egd=file:/dev/./urandom", "-jar", "app.jar"]

    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8081/find-alert/actuator || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

    networks:
      - app

    # Local khÃ´ng cáº§n Traefik â†’ Náº¿u báº¡n cáº§n, mÃ¬nh thÃªm láº¡i sau
    ports:
      - "8081:8081"

# =====================================================
# ðŸ”— Networks
# =====================================================
networks:
  app:
    driver: bridge
